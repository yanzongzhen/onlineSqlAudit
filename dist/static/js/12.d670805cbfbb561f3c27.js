webpackJsonp([12],{188:function(t,e,n){"use strict";function a(t){var e=navigator.userAgent;if("ie"===t){if(e.indexOf("compatible")>-1&&e.indexOf("MSIE")>-1){return new RegExp("MSIE (\\d+\\.\\d+);").test(e),parseFloat(RegExp.$1)}return!1}return e.indexOf(t)>-1}var i={_isIE11:function(){var t=0,e=/MSIE (\d+\.\d+);/.test(navigator.userAgent),n=!!navigator.userAgent.match(/Trident\/7.0/),a=navigator.userAgent.indexOf("rv:11.0");return e&&(t=Number(RegExp.$1)),-1!==navigator.appVersion.indexOf("MSIE 10")&&(t=10),n&&-1!==a&&(t=11),11===t},_isEdge:function(){return/Edge/.test(navigator.userAgent)},_getDownloadUrl:function(t){if(window.Blob&&window.URL&&window.URL.createObjectURL){var e=new Blob(["\ufeff"+t],{type:"text/csv"});return URL.createObjectURL(e)}return"data:attachment/csv;charset=utf-8,\ufeff"+encodeURIComponent(t)},download:function(t,e){if(a("ie")&&a("ie")<10){var n=window.top.open("about:blank","_blank");n.document.charset="utf-8",n.document.write(e),n.document.close(),n.document.execCommand("SaveAs",t),n.close()}else if(10===a("ie")||this._isIE11()||this._isEdge()){var i=new Blob(["\ufeff"+e],{type:"text/csv"});navigator.msSaveBlob(i,t)}else{var o=document.createElement("a");o.download=t,o.href=this._getDownloadUrl(e),document.body.appendChild(o),o.click(),document.body.removeChild(o)}}};e.a=i},189:function(t,e,n){"use strict";function a(t,e,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];n=Object.assign({},r,n);var l=void 0,s=[],d=[];return t?(l=t.map(function(t){return"string"==typeof t?t:(a||d.push(void 0!==t.title?t.title:t.key),t.key)}),d.length>0&&o(s,d,n)):(l=[],e.forEach(function(t){Array.isArray(t)||(l=l.concat(Object.keys(t)))}),l.length>0&&(l=l.filter(function(t,e,n){return n.indexOf(t)===e}),a||o(s,l,n))),Array.isArray(e)&&e.forEach(function(t){Array.isArray(t)||(t=l.map(function(e){return void 0!==t[e]?t[e]:""})),o(s,t,n)}),s.join(i)}e.a=a;var i="\r\n",o=function(t,e,n){var a=n.separator,i=n.quoted,o=e.map(function(t){return i?'"'+(t="string"==typeof t?t.replace(/"/g,'"'):t)+'"':t});t.push(o.join(a))},r={separator:",",quoted:!1}},307:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n(3),i=n.n(a),o=n(188),r=n(189),l=function(t){return void 0===t||null===t||""===t},s=function(t){t.filename?-1===t.filename.indexOf(".csv")&&(t.filename+=".csv"):t.filename="table.csv";var e=[],a=[];t.columns&&t.data?(e=t.columns,a=t.data):(e=this.columns,"original"in t||(t.original=!0),a=t.original?this.data:this.rebuildData);var i=!1;"noHeader"in t&&(i=t.noHeader);var l=n.i(r.a)(e,a,t,i);t.callback?t.callback(l):o.a.download(t.filename,l)};e.default={name:"myorder-list",data:function(){return{maxExport:!1,export:!1,columnsName1:[],Testresults:[],allsearchdata:[],total:0,filename:null,columnsName:[{title:"回滚语句",key:"sql"}],tabcolumns:[{title:"sql语句",key:"sql"},{title:"状态",key:"state",width:250},{title:"错误信息",key:"error",width:400},{title:"影响行数",key:"affectrow",width:100},{title:"执行时间/秒",key:"execute_time",width:200}],TableDataNew:[],sql:"",openswitch:!1,single:!1,reloadsql:!1,formItem:{computer_room:"",connection_name:"",basename:"",username:"",bundle_id:null},sqltype:null,dmlorddl:null}},methods:{downLoad:function(){window.location.href=this.$config.media+"/"+this.filename},rollback:function(){var t=this;if(this.sql="",40===this.TableDataNew[1].state.length){this.openswitch=!0;var e=this.TableDataNew.map(function(t){return t.sequence});e.splice(0,1),i.a.post(this.$config.url+"/detail/",{opid:JSON.stringify(e),id:this.$route.query.id}).then(function(e){t.formItem=e.data.data,t.formItem.backup="0";var n=!0,a=!1,i=void 0;try{for(var o,r=e.data.sql[Symbol.iterator]();!(n=(o=r.next()).done);n=!0){var l=o.value;t.sql+=l.sql+"\n"}}catch(t){a=!0,i=t}finally{try{!n&&r.return&&r.return()}finally{if(a)throw i}}t.sqltype=e.data.type,t.reloadsql=!0}).catch(function(){t.$config.err_notice(t,"无法获得相关回滚数据,请确认备份库配置正确及备份规则")})}else this.$Message.error("此工单没有备份或语句执行失败!")},exportdata:function(){this.allsearchdata?s({filename:"data_export",original:!0,data:this.allsearchdata,columns:this.columnsName1}):this.$Message.info("当前没有数据可以导出!")},repairOrder:function(){var t=this;i.a.put(this.$config.url+"/detail",{id:this.$route.query.id}).then(function(e){t.formItem=e.data.data,t.sql=e.data.sql,t.sqltype=e.data.type,t.formItem.backup="0"}).catch(function(e){t.$config.err_notice(t,e)}),this.reloadsql=!0},comorder:function(){var t=this,e=this.sql.replace(/(;|；)$/gi,"").replace(/\s/g," ").replace(/；/g,";").split(";");i.a.post(this.$config.url+"/sqlsyntax/",{data:JSON.stringify(this.formItem),sql:JSON.stringify(e),real_name:sessionStorage.getItem("real_name"),type:this.dmlorddl,id:this.formItem.bundle_id}).then(function(){t.$config.notice("工单已提交成功")}).catch(function(e){t.$config.err_notice(t,e)})},delorder:function(){var t=this,e=[];e.push({status:this.$route.query.status,id:this.$route.query.id}),i.a.post(this.$config.url+"/undoOrder",{id:JSON.stringify(e)}).then(function(e){t.$config.notice(e.data),t.$router.go(-1)}).catch(function(e){t.$config.err_notice(t,e)})},splice_arr:function(t){this.Testresults=this.allsearchdata.slice(10*t-10,10*t)}},mounted:function(){var t=this;i.a.get(this.$config.url+"/detail?workid="+this.$route.query.workid+"&status="+this.$route.query.status+"&id="+this.$route.query.id).then(function(e){e.data.hasOwnProperty("export")&&(t.export=e.data.export,t.allsearchdata=e.data.data.data,t.columnsName1=e.data.data.title,t.Testresults=t.allsearchdata.slice(0,100),t.total=e.data.data.len,l(e.data.filename)||(t.maxExport=!0,t.filename=e.data.filename)),t.TableDataNew=e.data.data,t.dmlorddl=e.data.type}).catch(function(e){t.$config.err_notice(t,e)})}}},326:function(t,e,n){e=t.exports=n(75)(!0),e.push([t.i,".demo-spin-icon-load{animation:ani-demo-spin 1s linear infinite}.margin-top-8{margin-top:8px}.margin-top-10{margin-top:10px}.margin-top-20{margin-top:20px}.margin-left-10{margin-left:10px}.margin-bottom-10{margin-bottom:10px}.margin-bottom-100{margin-bottom:100px}.margin-right-10{margin-right:10px}.padding-left-6{padding-left:6px}.padding-left-8{padding-left:5px}.padding-left-10{padding-left:10px}.padding-left-20{padding-left:20px}.height-100{height:100%}.height-120px{height:100px}.height-200px{height:200px}.height-492px{height:492px}.height-460px{height:460px}.line-gray{height:0;border-bottom:2px solid #dcdcdc}.notwrap{word-break:keep-all;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.padding-left-5{padding-left:10px}[v-cloak]{display:none}.dragging-tip-enter-active{opacity:1;transition:opacity .3s}.dragging-tip-enter,.dragging-tip-leave-to{opacity:0;transition:opacity .3s}.dragging-tip-con{display:block;text-align:center;width:100%;height:50px}.dragging-tip-con span{font-size:18px}.record-tip-con{display:block;width:100%;height:292px;overflow:auto}.record-item{box-sizing:content-box;display:block;overflow:hidden;height:24px;line-height:24px;padding:8px 10px;border-bottom:1px dashed #dcdcdc}.record-tip-con span{font-size:14px}.edittable-test-con{min-height:600px}.edittable-testauto-con{height:100%}.edittable-table-height-con{min-height:600px}.edittable-table-height1-con{height:200px}.edittable-con-1{box-sizing:content-box;padding:15px 0 0;height:550px}.exportable-table-download-con1{padding:16px 0 16px 20px;border-bottom:1px dashed #c3c3c3;margin-bottom:16px}.exportable-table-download-con2{padding-left:20px}.show-image{padding:20px 0}.show-image img{display:block;width:100%;height:auto}.top{padding:10px;background:rgba(0,153,229,.7);color:#fff;text-align:center;border-radius:2px}","",{version:3,sources:["E:/inspur_projects/Audit/webpage/src/components/order/components/myorderList.vue"],names:[],mappings:"AACA,qBACE,0CAA4C,CAC7C,AACD,cACE,cAAgB,CACjB,AACD,eACE,eAAiB,CAClB,AACD,eACE,eAAiB,CAClB,AACD,gBACE,gBAAkB,CACnB,AACD,kBACE,kBAAoB,CACrB,AACD,mBACE,mBAAqB,CACtB,AACD,iBACE,iBAAmB,CACpB,AACD,gBACE,gBAAkB,CACnB,AACD,gBACE,gBAAkB,CACnB,AACD,iBACE,iBAAmB,CACpB,AACD,iBACE,iBAAmB,CACpB,AACD,YACE,WAAa,CACd,AACD,cACE,YAAc,CACf,AACD,cACE,YAAc,CACf,AACD,cACE,YAAc,CACf,AACD,cACE,YAAc,CACf,AACD,WACE,SAAU,AACV,+BAAiC,CAClC,AACD,SACE,oBAAqB,AACrB,mBAAoB,AACpB,gBAAiB,AACjB,sBAAwB,CACzB,AACD,gBACE,iBAAmB,CACpB,AACD,UACE,YAAc,CACf,AACD,2BACE,UAAW,AACX,sBAAyB,CAC1B,AACD,2CAEE,UAAW,AACX,sBAAyB,CAC1B,AACD,kBACE,cAAe,AACf,kBAAmB,AACnB,WAAY,AACZ,WAAa,CACd,AACD,uBACE,cAAgB,CACjB,AACD,gBACE,cAAe,AACf,WAAY,AACZ,aAAc,AACd,aAAe,CAChB,AACD,aACE,uBAAwB,AACxB,cAAe,AACf,gBAAiB,AACjB,YAAa,AACb,iBAAkB,AAClB,iBAAkB,AAClB,gCAAoC,CACrC,AACD,qBACE,cAAgB,CACjB,AACD,oBACE,gBAAkB,CACnB,AACD,wBACE,WAAa,CACd,AACD,4BACE,gBAAkB,CACnB,AACD,6BACE,YAAc,CACf,AACD,iBACE,uBAAwB,AACxB,iBAAkB,AAClB,YAAc,CACf,AACD,gCACE,yBAA0B,AAC1B,iCAAkC,AAClC,kBAAoB,CACrB,AACD,gCACE,iBAAmB,CACpB,AACD,YACE,cAAgB,CACjB,AACD,gBACE,cAAe,AACf,WAAY,AACZ,WAAa,CACd,AACD,KACE,aAAc,AACd,8BAAmC,AACnC,WAAY,AACZ,kBAAmB,AACnB,iBAAmB,CACpB",file:"myorderList.vue",sourcesContent:["\n.demo-spin-icon-load {\n  animation: ani-demo-spin 1s linear infinite;\n}\n.margin-top-8 {\n  margin-top: 8px;\n}\n.margin-top-10 {\n  margin-top: 10px;\n}\n.margin-top-20 {\n  margin-top: 20px;\n}\n.margin-left-10 {\n  margin-left: 10px;\n}\n.margin-bottom-10 {\n  margin-bottom: 10px;\n}\n.margin-bottom-100 {\n  margin-bottom: 100px;\n}\n.margin-right-10 {\n  margin-right: 10px;\n}\n.padding-left-6 {\n  padding-left: 6px;\n}\n.padding-left-8 {\n  padding-left: 5px;\n}\n.padding-left-10 {\n  padding-left: 10px;\n}\n.padding-left-20 {\n  padding-left: 20px;\n}\n.height-100 {\n  height: 100%;\n}\n.height-120px {\n  height: 100px;\n}\n.height-200px {\n  height: 200px;\n}\n.height-492px {\n  height: 492px;\n}\n.height-460px {\n  height: 460px;\n}\n.line-gray {\n  height: 0;\n  border-bottom: 2px solid #dcdcdc;\n}\n.notwrap {\n  word-break: keep-all;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.padding-left-5 {\n  padding-left: 10px;\n}\n[v-cloak] {\n  display: none;\n}\n.dragging-tip-enter-active {\n  opacity: 1;\n  transition: opacity 0.3s;\n}\n.dragging-tip-enter,\n.dragging-tip-leave-to {\n  opacity: 0;\n  transition: opacity 0.3s;\n}\n.dragging-tip-con {\n  display: block;\n  text-align: center;\n  width: 100%;\n  height: 50px;\n}\n.dragging-tip-con span {\n  font-size: 18px;\n}\n.record-tip-con {\n  display: block;\n  width: 100%;\n  height: 292px;\n  overflow: auto;\n}\n.record-item {\n  box-sizing: content-box;\n  display: block;\n  overflow: hidden;\n  height: 24px;\n  line-height: 24px;\n  padding: 8px 10px;\n  border-bottom: 1px dashed gainsboro;\n}\n.record-tip-con span {\n  font-size: 14px;\n}\n.edittable-test-con {\n  min-height: 600px;\n}\n.edittable-testauto-con {\n  height: 100%;\n}\n.edittable-table-height-con {\n  min-height: 600px;\n}\n.edittable-table-height1-con {\n  height: 200px;\n}\n.edittable-con-1 {\n  box-sizing: content-box;\n  padding: 15px 0 0;\n  height: 550px;\n}\n.exportable-table-download-con1 {\n  padding: 16px 0 16px 20px;\n  border-bottom: 1px dashed #c3c3c3;\n  margin-bottom: 16px;\n}\n.exportable-table-download-con2 {\n  padding-left: 20px;\n}\n.show-image {\n  padding: 20px 0;\n}\n.show-image img {\n  display: block;\n  width: 100%;\n  height: auto;\n}\n.top {\n  padding: 10px;\n  background: rgba(0, 153, 229, 0.7);\n  color: #fff;\n  text-align: center;\n  border-radius: 2px;\n}\n"],sourceRoot:""}])},604:function(t,e,n){var a=n(326);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);n(76)("10a15476",a,!0,{})},638:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("Row",[n("Card",[n("div",{staticStyle:{height:"45px"},attrs:{slot:"title"},slot:"title"},[n("Icon",{attrs:{type:"android-send"}}),t._v("\n        工单"+t._s(this.$route.query.workid)+"详细信息\n        "),n("br"),t._v(" "),this.export?t._e():n("section",[1===this.$route.query.status?n("Button",{attrs:{type:"text"},nativeOn:{click:function(e){return t.rollback()}}},[t._v("查看回滚语句")]):0===this.$route.query.status||4===this.$route.query.status?n("Button",{attrs:{type:"text"},nativeOn:{click:function(e){return t.repairOrder()}}},[t._v("重新提交\n            ")]):t._e()],1),t._v(" "),2===this.$route.query.status?n("Button",{attrs:{type:"text"},nativeOn:{click:function(e){return t.delorder()}}},[t._v("工单撤销")]):t._e(),t._v(" "),this.export&&!this.maxExport?n("Button",{attrs:{type:"text"},nativeOn:{click:function(e){return t.exportdata()}}},[t._v("导出数据")]):t._e(),t._v(" "),n("Button",{attrs:{type:"text"},nativeOn:{click:function(e){return t.$router.go(-1)}}},[t._v("返回")])],1),t._v(" "),this.export?t._e():n("Row",[n("Col",{attrs:{span:"24"}},[n("Table",{staticClass:"tabletop",staticStyle:{background:"#5cadff"},attrs:{border:"",columns:t.tabcolumns,data:t.TableDataNew,size:"large"}})],1)],1),t._v(" "),this.export&&!this.maxExport?n("section",[n("p",[t._v("查询结果:")]),t._v(" "),n("Table",{ref:"table",attrs:{columns:t.columnsName1,data:t.Testresults,"highlight-row":""}}),t._v(" "),n("br"),t._v(" "),n("Page",{ref:"totol",attrs:{total:t.total,"show-total":""},on:{"on-change":t.splice_arr}})],1):t._e(),t._v(" "),this.maxExport?n("section",[n("h3",[t._v("数据量超大，请点击下载查询文件")]),t._v(" "),n("Button",{attrs:{type:"primary"},nativeOn:{click:function(e){return t.downLoad()}}},[t._v("下载文件")])],1):t._e()],1)],1),t._v(" "),n("BackTop",{attrs:{height:100,bottom:200}},[n("div",{staticClass:"top"},[t._v("返回顶端")])]),t._v(" "),n("Modal",{attrs:{"ok-text":"提交工单",width:"800"},on:{"on-ok":t.comorder},model:{value:t.reloadsql,callback:function(e){t.reloadsql=e},expression:"reloadsql"}},[n("Row",[n("Card",[n("div",{staticClass:"step-header-con"},[n("h3",[t._v("Yearning SQL平台审核工单")])]),t._v(" "),n("p",{staticClass:"step-content"}),t._v(" "),n("Form",{staticClass:"step-form",attrs:{"label-width":100}},[n("FormItem",{attrs:{label:"用户名:"}},[n("p",[t._v(t._s(t.formItem.username))])]),t._v(" "),n("FormItem",{attrs:{label:"机房:"}},[n("p",[t._v(t._s(t.formItem.computer_room))])]),t._v(" "),n("FormItem",{attrs:{label:"连接名:"}},[n("p",[t._v(t._s(t.formItem.connection_name))])]),t._v(" "),n("FormItem",{attrs:{label:"数据库库名:"}},[n("p",[t._v(t._s(t.formItem.basename))])]),t._v(" "),n("FormItem",{attrs:{label:"定时执行:"}},[n("p",[t._v(t._s(t.formItem.delay))])]),t._v(" "),n("FormItem",[n("Input",{attrs:{type:"textarea",rows:8},model:{value:t.sql,callback:function(e){t.sql=e},expression:"sql"}})],1),t._v(" "),n("FormItem",{attrs:{label:"工单提交说明:"}},[n("Input",{attrs:{placeholder:"最多不超过20个字"},model:{value:t.formItem.text,callback:function(e){t.$set(t.formItem,"text",e)},expression:"formItem.text"}})],1),t._v(" "),n("FormItem",{attrs:{label:"是否备份"}},[n("RadioGroup",{model:{value:t.formItem.backup,callback:function(e){t.$set(t.formItem,"backup",e)},expression:"formItem.backup"}},[n("Radio",{attrs:{label:"1"}},[t._v("是")]),t._v(" "),n("Radio",{attrs:{label:"0"}},[t._v("否")])],1)],1)],1)],1)],1)],1)],1)},staticRenderFns:[]}},90:function(t,e,n){function a(t){n(604)}var i=n(1)(n(307),n(638),a,null,null);t.exports=i.exports}});
//# sourceMappingURL=12.d670805cbfbb561f3c27.js.map